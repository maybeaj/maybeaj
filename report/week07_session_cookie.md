# 세션과 쿠키 기반 인증 완벽 가이드

## 1. 기본 개념 이해

### HTTP의 무상태성(Stateless)
HTTP는 기본적으로 무상태 프로토콜입니다. 각 요청은 독립적이며, 서버는 이전 요청에 대한 정보를 기억하지 않습니다. 따라서 사용자의 로그인 상태를 유지하기 위해서는 별도의 메커니즘이 필요합니다.

<br>

### 쿠키(Cookie)란?
- 서버가 사용자의 웹 브라우저에 전송하는 작은 데이터 조각

- 브라우저가 저장했다가 동일한 서버에 재요청할 때 함께 전송

- 키-값 쌍으로 구성되며, 만료 시간, 도메인, 경로 등의 속성을 가짐

### 세션(Session)이란?
- 서버 측에서 사용자 정보를 임시로 저장하는 방법

- 각 사용자에게 고유한 세션 ID를 부여

- 세션 ID는 일반적으로 쿠키를 통해 클라이언트에 전달

<br><br><br>

## 2. 상태 유지 전략 비교

### 세션 vs 쿠키 기반 인증 비교표

<br>

| 구분 | 세션 기반 인증 | 쿠키(JWT) 기반 인증 |
|------|----------------|-------------------|
| **데이터 저장 위치** | 서버 측 | 클라이언트 측 |
| **클라이언트 보관 정보** | 세션 ID만 | 모든 사용자 정보 |
| **서버 메모리 사용** | 높음 (세션 데이터 저장) | 낮음 (상태 비저장) |
| **보안성** | 높음 (서버에서 관리) | 보통 (암호화/서명 필요) |
| **확장성** | 제한적 (세션 공유 복잡) | 우수 (상태 비공유) |
| **네트워크 트래픽** | 적음 (ID만 전송) | 많음 (전체 정보 전송) |
| **세션 제어** | 즉시 가능 | 제한적 (만료 시간 의존) |
| **서버 부하** | 높음 | 낮음 |
| **구현 복잡도** | 보통 | 높음 (보안 처리) |

<br>

### 동작 과정 비교

| 단계 | 세션 기반 | 쿠키 기반 |
|------|-----------|-----------|
| **1. 로그인** | 인증 정보 확인 | 인증 정보 확인 |
| **2. 토큰 생성** | 세션 ID 생성 | JWT 토큰 생성 및 서명 |
| **3. 저장** | 서버: 세션 데이터 저장<br>클라이언트: 세션 ID만 저장 | 클라이언트: JWT 전체 저장 |
| **4. 인증 요청** | 세션 ID 전송 | JWT 토큰 전송 |
| **5. 검증** | 서버에서 세션 ID로 데이터 조회 | 서버에서 JWT 서명 검증 |
| **6. 로그아웃** | 서버에서 세션 삭제 | 클라이언트에서 토큰 삭제 |


<br><br><br>


## 3. 로그인 구조 적용 예시

### 세션 기반 인증 흐름

#### 1. 로그인 과정

1) 사용자가 로그인 폼에 ID/PW 입력

2) 서버에서 자격증명 검증

3) 데이터베이스에서 사용자 정보 조회

4) 비밀번호 해시 비교

5) 인증 성공 시 세션 생성

6) 서버 메모리/DB에 세션 데이터 저장

7) 고유한 세션 ID 생성

8) 세션 ID를 쿠키로 클라이언트에 전송
> Set-Cookie: sessionId=abc123; HttpOnly; Secure


<br>


#### 2. 인증이 필요한 요청 처리

1) 클라이언트가 요청 시 쿠키 자동 전송

2) 서버에서 세션 ID 추출 및 검증

3) 쿠키에서 세션 ID 읽기

4) 서버 세션 저장소에서 해당 세션 조회

5) 세션 유효성 확인

6) 세션 존재 여부

7) 세션 만료 시간 확인

8) 인증된 요청으로 처리 또는 로그인 페이지로 리다이렉트

<br>

#### 3. 로그아웃 과정

1) 서버에서 세션 데이터 삭제

2) 클라이언트 쿠키 무효화
> Set-Cookie: sessionId=; expires=Thu, 01 Jan 1970 00:00:00 GMT

<br>

## 쿠키 기반 인증의 특징

### 장점

- 자동 전송: 브라우저가 자동으로 쿠키를 요청에 포함

- 보안 옵션: HttpOnly, Secure, SameSite 등으로 보안 강화

- 서버 상태 관리: 세션을 통해 사용자 상태 추적 가능

### 단점

- 서버 부하: 세션 데이터를 서버에서 관리해야 함

- 확장성: 여러 서버 환경에서 세션 공유 복잡

- CSRF 취약성: 쿠키 자동 전송으로 인한 보안 위험

<br>

### 실제 적용 구조

#### 미들웨어 패턴
> 요청 → 쿠키 파싱 → 세션 검증 → 사용자 인증 확인 → 라우트 핸들러

<br>

### 보호된 라우트 구조

1. 모든 요청에서 세션 쿠키 확인

2. 인증 필요한 페이지 접근 시 검증

3. 미인증 시 로그인 페이지로 리다이렉트

4. 인증 완료 시 원래 요청 페이지로 이동

<br>

### 세션 저장소 옵션

- 메모리: 개발 환경, 단일 서버

- Redis: 분산 환경, 빠른 접근

- 데이터베이스: 영속성이 중요한 경우


<br><br><br>



## 4. 보안 고려사항

### 보안 조치 비교표

| 보안 영역 | 세션 기반 | 쿠키(JWT) 기반 | 공통 사항 |
|-----------|-----------|----------------|-----------|
| **데이터 보호** | 서버 측 저장으로 안전 | 암호화/서명 필수 | HTTPS 통신 |
| **세션 관리** | 서버에서 즉시 무효화 | 토큰 만료 시간 의존 | HttpOnly 쿠키 설정 |
| **저장소 보안** | Redis/DB 보안 필요 | 클라이언트 보안 의존 | Secure 쿠키 플래그 |
| **토큰 갱신** | 세션 재생성 | 리프레시 토큰 | SameSite 속성 설정 |
| **공격 방어** | 세션 하이재킹 방지 | JWT 변조 방지 | CSRF 토큰 사용 |


<br>


### 쿠키 보안 속성 설정표

| 속성 | 설정값 | 목적 | 세션 기반 | JWT 기반 |
|------|--------|------|-----------|----------|
| **HttpOnly** | true | XSS 공격 방지 | ✅ 필수 | ✅ 필수 |
| **Secure** | true (HTTPS) | 네트워크 도청 방지 | ✅ 필수 | ✅ 필수 |
| **SameSite** | Strict/Lax | CSRF 공격 방지 | ✅ 권장 | ✅ 권장 |
| **MaxAge** | 초 단위 | 토큰 수명 제한 | ✅ 설정 | ✅ 설정 |
| **Domain** | 도메인 지정 | 쿠키 전송 범위 제한 | 선택적 | 선택적 |
| **Path** | 경로 지정 | 쿠키 전송 경로 제한 | 선택적 | 선택적 |


<br>


## 5. 선택 기준

### 프로젝트 요구사항별 선택 가이드

| 요구사항 | 세션 기반 선택 | 쿠키(JWT) 기반 선택 |
|----------|----------------|-------------------|
| **보안 우선순위** | 높음 (금융, 의료) | 보통 (일반 웹서비스) |
| **서버 아키텍처** | 단일 서버, 클러스터링 가능 | 마이크로서비스, 분산 환경 |
| **사용자 규모** | 중소규모 (동시 접속자 관리) | 대규모 (확장성 우선) |
| **세션 제어** | 실시간 세션 무효화 필요 | 토큰 만료 시간으로 충분 |
| **서버 리소스** | 충분한 메모리/스토리지 | 제한적 리소스 |
| **개발 복잡도** | 간단한 구현 선호 | 보안 구현 가능 |


<br>


### 성능 특성 비교

| 성능 지표 | 세션 기반 | 쿠키(JWT) 기반 | 비고 |
|-----------|-----------|----------------|------|
| **초기 로그인 속도** | 빠름 | 보통 (토큰 생성) | JWT 서명 과정 |
| **인증 요청 속도** | 보통 (DB 조회) | 빠름 (로컬 검증) | 세션 저장소 의존 |
| **메모리 사용량** | 높음 | 낮음 | 활성 사용자 수 비례 |
| **네트워크 대역폭** | 낮음 | 높음 | 토큰 크기 차이 |
| **확장성** | 제한적 | 우수 | 상태 공유 필요성 |


<br>


### 기술 스택별 권장사항

| 기술 스택 | 권장 방식 | 이유 |
|-----------|-----------|------|
| **전통적인 MVC** | 세션 기반 | 서버 템플릿 렌더링에 적합 |
| **SPA + API 서버** | JWT 기반 | 클라이언트-서버 분리에 적합 |
| **마이크로서비스** | JWT 기반 | 서비스 간 상태 공유 불필요 |
| **모바일 앱** | JWT 기반 | 네이티브 앱에서 토큰 관리 용이 |
| **실시간 애플리케이션** | 세션 기반 | WebSocket 세션과 HTTP 세션 통합 |

