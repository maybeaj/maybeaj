
## 📘 강의 제목: MongoDB 이해하기 – NoSQL의 대표주자

### 👤 대상

* 웹 백엔드 또는 풀스택 개발자 지망생
* 관계형 DB(RDBMS)는 경험했지만 NoSQL은 처음 접하는 학습자

### 🎯 학습 목표

* MongoDB의 구조와 동작 방식을 이해한다
* 관계형 데이터베이스와의 차이를 비교할 수 있다
* MongoDB의 기본적인 CRUD 작업을 할 수 있다

---

## 1. MongoDB란?

| 항목       | 설명                                  |
| -------- | ----------------------------------- |
| 🔍 정의    | JSON 기반의 문서(Document)형 NoSQL 데이터베이스 |
| 💡 특징    | 스키마가 유연하고, 고성능 읽기/쓰기, 수평 확장 가능      |
| 🧩 사용언어  | Node.js, Python, Java 등 다양한 언어 지원   |
| 🔗 데이터형태 | BSON(Binary JSON) 포맷 사용             |

---

## 2. RDB vs MongoDB 비교

| 항목  | RDB(Relational DB) | MongoDB(NoSQL, Document) |
| --- | ------------------ | ------------------------ |
| 구조  | 테이블, 행, 열          | 컬렉션, 문서                  |
| 스키마 | 엄격한 스키마 필요         | 스키마가 유연함                 |
| 조인  | JOIN 사용            | 데이터 중첩(Nested)           |
| 확장성 | 수직 확장(Scale-Up)    | 수평 확장(Scale-Out)         |
| 예시  | MySQL, PostgreSQL  | MongoDB, CouchDB         |

---

## 3. 핵심 개념 정리

| 용어             | 설명                         |
| -------------- | -------------------------- |
| **Database**   | 데이터베이스 하나 (RDB의 DB와 동일)    |
| **Collection** | 테이블과 유사, 문서(Document)들의 집합 |
| **Document**   | 하나의 JSON 객체처럼 생긴 데이터 단위    |
| **Field**      | JSON의 키-값 쌍 형태의 속성         |
| **ObjectId**   | 각 문서의 고유 식별자 (\_id)        |

```json
// 예시 문서 (Document)
{
  "_id": ObjectId("abc123..."),
  "title": "Hello MongoDB",
  "author": "Lee",
  "tags": ["database", "NoSQL"],
  "createdAt": "2025-07-27T12:34:00Z"
}
```

---

## 4. MongoDB 설치 및 시작하기

### 로컬 설치 (mac 기준)

```bash
brew tap mongodb/brew
brew install mongodb-community@7.0
brew services start mongodb-community
```

### CLI 접속

```bash
mongosh
```

---

## 5. 기본 명령어

| 작업        | 명령어 예시                                                             |
| --------- | ------------------------------------------------------------------ |
| 데이터베이스 선택 | `use mydb`                                                         |
| 컬렉션 생성    | `db.posts.insertOne({...})`                                        |
| 데이터 조회    | `db.posts.find()`                                                  |
| 조건 조회     | `db.posts.find({ author: "Lee" })`                                 |
| 수정        | `db.posts.updateOne({ _id: ... }, { $set: { title: "updated" } })` |
| 삭제        | `db.posts.deleteOne({ _id: ... })`                                 |

---

## 6. MongoDB Compass 소개

* MongoDB 공식 GUI 툴
* 데이터베이스를 시각적으로 확인 가능
* 쿼리도 GUI에서 실행 가능
* [https://www.mongodb.com/try/download/compass](https://www.mongodb.com/try/download/compass)

---

## 7. 언제 MongoDB를 사용할까?

✅ 적합한 경우:

* 빠르게 변화하는 데이터 구조 (스타트업 MVP 등)
* 로그, 센서 데이터, 채팅 등 대량의 비정형 데이터
* 스키마가 유연한 프로젝트

🚫 부적합한 경우:

* 복잡한 트랜잭션 처리
* 정교한 JOIN이 필요한 비즈니스 로직

---

## 8. 실습 예제

```bash
# 데이터베이스 접속
mongosh

# DB 선택
use testdb

# 데이터 삽입
db.users.insertOne({ name: "Jaehee", age: 30 })

# 전체 조회
db.users.find()

# 특정 조건 조회
db.users.find({ age: { $gt: 25 } })
```

---

## 9. 보너스: MongoDB Atlas란?

* MongoDB의 공식 클라우드 서비스
* 무료 플랜 제공 (M0 클러스터)
* 서버 설치 없이 클라우드로 개발 가능
* [https://www.mongodb.com/cloud/atlas](https://www.mongodb.com/cloud/atlas)

---

## 📌 마무리 정리

* MongoDB는 **문서기반 NoSQL**로 유연하고 확장성이 뛰어남
* RDB와 비교 시 JOIN은 약하지만 구조 유연성에서 강점
* `mongoose`, `MongoDB Atlas`, `Compass` 등을 함께 사용하면 편리함

---

## 🙋🏻 실습 과제

1. `users` 컬렉션에 데이터 3개 삽입
2. 나이가 25 이상인 사람만 조회하는 쿼리 작성
3. `isActive: true` 필드를 추가하는 update 쿼리 작성
4. `MongoDB Atlas` 계정 생성 및 클러스터 연결 실습


# 📘 강의 자료: MongoDB CRUD 완전 정복

---

## 🧭 학습 목표

* MongoDB에서 CRUD 개념을 이해한다
* 각 명령어의 기본 문법과 동작 방식을 익힌다
* 실제 데이터를 다루는 실습을 통해 MongoDB 명령어를 사용할 수 있다

---

## 📦 CRUD란?

| 분류 | 기능     | MongoDB 명령어                             | 설명                  |
| -- | ------ | --------------------------------------- | ------------------- |
| C  | Create | `insertOne`, `insertMany`               | 문서(Document)를 새로 추가 |
| R  | Read   | `find`, `findOne`                       | 문서 검색 및 조회          |
| U  | Update | `updateOne`, `updateMany`, `replaceOne` | 문서의 필드 변경           |
| D  | Delete | `deleteOne`, `deleteMany`               | 문서를 삭제              |

---

## 🧪 실습 환경 준비

### MongoDB Shell 접속

```bash
mongosh
```

### 데이터베이스 선택

```js
use doItDB
```

---

## ✅ 1. Create (데이터 생성)

### 단일 문서 삽입

```js
db.users.insertOne({
  name: "Jaehee",
  age: 28,
  email: "jaehee@example.com"
})
```

### 여러 문서 삽입

```js
db.users.insertMany([
  { name: "Mina", age: 25, email: "mina@example.com" },
  { name: "Dohyung", age: 30, email: "dohyung@example.com" }
])
```

✅ `_id`는 자동 생성되며, 고유 식별자 역할

---

## 🔍 2. Read (데이터 조회)

### 전체 조회

```js
db.users.find()
```

### 정렬, 제한, 페이징

```js
db.users.find().sort({ age: -1 }).limit(2)
```

### 조건 조회

```js
// 나이가 26 이상인 사용자 조회
db.users.find({ age: { $gte: 26 } })

// 이메일이 특정 문자열 포함
db.users.find({ email: /example/ })
```

### 특정 필드만 조회

```js
db.users.find({}, { name: 1, email: 1, _id: 0 })
```

---

## ✏️ 3. Update (데이터 수정)

### 단일 문서 수정

```js
db.users.updateOne(
  { name: "Jaehee" },
  { $set: { age: 29 } }
)
```

### 여러 문서 수정

```js
db.users.updateMany(
  { age: { $gte: 30 } },
  { $set: { status: "veteran" } }
)
```

### 필드 추가 또는 삭제

```js
// 필드 추가
db.users.updateOne({ name: "Mina" }, { $set: { gender: "female" } })

// 필드 제거
db.users.updateOne({ name: "Mina" }, { $unset: { gender: "" } })
```

---

## 🗑️ 4. Delete (데이터 삭제)

### 단일 문서 삭제

```js
db.users.deleteOne({ name: "Jaehee" })
```

### 여러 문서 삭제

```js
db.users.deleteMany({ age: { $lt: 28 } })
```

⚠️ `deleteMany()`는 조건에 맞는 **모든** 문서를 삭제합니다. 주의!

---

## 🧠 실습 과제

| 번호 | 작업 설명                                |
| -- | ------------------------------------ |
| 1  | 사용자 3명 데이터를 insertOne/insertMany로 삽입 |
| 2  | 나이가 26세 이상인 사용자만 조회 (정렬 + 일부 필드만 표시) |
| 3  | 특정 사용자의 이메일을 수정                      |
| 4  | 전체 사용자에게 `isActive: true` 필드 추가      |
| 5  | 25세 미만 사용자는 삭제                       |

---

## 🧩 자주 쓰는 연산자 요약

| 연산자                          | 설명        |
| ---------------------------- | --------- |
| `$set`                       | 필드를 추가/수정 |
| `$unset`                     | 필드를 제거    |
| `$gt`, `$lt`, `$gte`, `$lte` | 비교 연산자    |
| `$in`, `$nin`                | 값 포함 여부   |
| `$regex`                     | 정규 표현식    |
| `$or`, `$and`                | 논리 연산자    |

---

## 🎓 실무 팁

* `ObjectId("...")`로 `_id` 검색 가능
* 복잡한 필터 조건은 `find()` 안에 JSON 구조로 표현
* 데이터를 조회한 후 수정할 때는 `find()` → `update()`
* Compass(GUI)를 사용하면 결과 확인이 더 쉬움

---

## 📘 마무리 정리

* CRUD는 모든 MongoDB 작업의 핵심
* 데이터를 다룰 때는 조건 필터와 연산자에 익숙해져야 함
* 실습을 반복하며 명령어를 자연스럽게 익히자

---

## 📦 보너스 실습: 게시판 DB

```js
use boardDB

db.posts.insertOne({
  title: "첫 글입니다",
  author: "admin",
  content: "MongoDB는 쉽고 강력해요!",
  createdAt: new Date()
})

db.posts.find()
```


# MongoDB 완전 학습 가이드

## 목차
1. [MongoDB 소개](#1-mongodb-소개)
2. [설치 및 설정](#2-설치-및-설정)
3. [기본 개념](#3-기본-개념)
4. [CRUD 연산](#4-crud-연산)
5. [쿼리 및 필터링](#5-쿼리-및-필터링)
6. [인덱싱](#6-인덱싱)
7. [집계(Aggregation)](#7-집계aggregation)
8. [데이터 모델링](#8-데이터-모델링)
9. [복제 및 샤딩](#9-복제-및-샤딩)
10. [성능 최적화](#10-성능-최적화)
11. [보안](#11-보안)
12. [실제 프로젝트 예제](#12-실제-프로젝트-예제)

---

## 1. MongoDB 소개

### 1.1 MongoDB란?
MongoDB는 NoSQL 문서 지향 데이터베이스입니다. JSON과 유사한 BSON(Binary JSON) 형태로 데이터를 저장하며, 스키마가 유연하고 확장성이 뛰어납니다.

### 1.2 특징
- **문서 지향**: JSON 형태의 문서로 데이터 저장
- **스키마 유연성**: 고정된 스키마 없이 동적 구조 지원
- **확장성**: 수평적 확장(샤딩) 지원
- **고성능**: 인덱싱과 집계 파이프라인 제공
- **고가용성**: 복제 세트를 통한 자동 장애 복구

### 1.3 언제 사용하나?
- 빠른 개발이 필요한 경우
- 스키마가 자주 변경되는 경우
- 대용량 데이터 처리가 필요한 경우
- 복잡한 조인이 적은 경우

---

## 2. 설치 및 설정

### 2.1 Windows 설치
```bash
# MongoDB Community Server 다운로드
# https://www.mongodb.com/try/download/community

# 서비스 시작
net start MongoDB

# MongoDB Compass 설치 (GUI 도구)
```

### 2.2 macOS 설치
```bash
# Homebrew 사용
brew tap mongodb/brew
brew install mongodb-community

# 서비스 시작
brew services start mongodb/brew/mongodb-community
```

### 2.3 Linux 설치
```bash
# Ubuntu/Debian
wget -qO - https://www.mongodb.org/static/pgp/server-7.0.asc | sudo apt-key add -
echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/7.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-7.0.list
sudo apt-get update
sudo apt-get install -y mongodb-org

# 서비스 시작
sudo systemctl start mongod
sudo systemctl enable mongod
```

### 2.4 Docker 설치
```bash
# MongoDB 컨테이너 실행
docker run --name mongodb -d -p 27017:27017 mongo:latest

# 데이터 영구 저장
docker run --name mongodb -d -p 27017:27017 -v /my/data:/data/db mongo:latest
```

---

## 3. 기본 개념

### 3.1 용어 비교
| RDBMS | MongoDB |
|-------|---------|
| Database | Database |
| Table | Collection |
| Row | Document |
| Column | Field |
| Index | Index |
| Join | Embedded Document or Reference |

### 3.2 데이터베이스 연결
```javascript
// MongoDB Shell 연결
mongosh

// 특정 데이터베이스 사용
use myDatabase

// 현재 데이터베이스 확인
db

// 데이터베이스 목록 조회
show dbs

// 컬렉션 목록 조회
show collections
```

### 3.3 BSON 데이터 타입
```javascript
{
  "_id": ObjectId("..."),           // 고유 식별자
  "string": "텍스트",               // 문자열
  "number": 42,                     // 숫자
  "boolean": true,                  // 불린
  "array": [1, 2, 3],              // 배열
  "object": { "key": "value" },     // 객체
  "date": new Date(),               // 날짜
  "null": null,                     // null
  "regex": /pattern/i               // 정규표현식
}
```

---

## 4. CRUD 연산

### 4.1 Create (생성)

#### 단일 문서 삽입
```javascript
db.users.insertOne({
  name: "홍길동",
  email: "hong@example.com",
  age: 30,
  address: {
    city: "서울",
    district: "강남구"
  },
  hobbies: ["독서", "영화감상"],
  createdAt: new Date()
})
```

#### 다중 문서 삽입
```javascript
db.users.insertMany([
  {
    name: "김철수",
    email: "kim@example.com",
    age: 25
  },
  {
    name: "이영희",
    email: "lee@example.com",
    age: 28
  }
])
```

### 4.2 Read (조회)

#### 모든 문서 조회
```javascript
db.users.find()

// 예쁘게 출력
db.users.find().pretty()
```

#### 조건부 조회
```javascript
// 단일 조건
db.users.find({ name: "홍길동" })

// 다중 조건 (AND)
db.users.find({ 
  age: { $gte: 25 }, 
  "address.city": "서울" 
})

// OR 조건
db.users.find({
  $or: [
    { age: { $lt: 25 } },
    { age: { $gt: 35 } }
  ]
})
```

#### 프로젝션 (필드 선택)
```javascript
// 특정 필드만 조회
db.users.find({}, { name: 1, email: 1 })

// 특정 필드 제외
db.users.find({}, { password: 0 })
```

#### 정렬 및 제한
```javascript
// 정렬 (1: 오름차순, -1: 내림차순)
db.users.find().sort({ age: -1 })

// 제한
db.users.find().limit(5)

// 건너뛰기
db.users.find().skip(10).limit(5)
```

### 4.3 Update (수정)

#### 단일 문서 수정
```javascript
db.users.updateOne(
  { name: "홍길동" },                    // 조건
  { 
    $set: { 
      age: 31,
      "address.district": "서초구"
    },
    $push: { hobbies: "운동" }          // 배열에 추가
  }
)
```

#### 다중 문서 수정
```javascript
db.users.updateMany(
  { age: { $lt: 30 } },
  { $set: { status: "young" } }
)
```

#### 문서 교체
```javascript
db.users.replaceOne(
  { name: "홍길동" },
  {
    name: "홍길동",
    email: "new@example.com",
    age: 32
  }
)
```

### 4.4 Delete (삭제)

#### 단일 문서 삭제
```javascript
db.users.deleteOne({ name: "홍길동" })
```

#### 다중 문서 삭제
```javascript
db.users.deleteMany({ age: { $lt: 20 } })
```

#### 컬렉션 전체 삭제
```javascript
db.users.drop()
```

---

## 5. 쿼리 및 필터링

### 5.1 비교 연산자
```javascript
// 같음
db.users.find({ age: 30 })

// 크기 비교
db.users.find({ age: { $gt: 25 } })      // 초과
db.users.find({ age: { $gte: 25 } })     // 이상
db.users.find({ age: { $lt: 35 } })      // 미만
db.users.find({ age: { $lte: 35 } })     // 이하
db.users.find({ age: { $ne: 30 } })      // 같지 않음

// 범위
db.users.find({ age: { $gte: 25, $lte: 35 } })

// 포함
db.users.find({ age: { $in: [25, 30, 35] } })
db.users.find({ age: { $nin: [25, 30, 35] } })
```

### 5.2 논리 연산자
```javascript
// AND (기본)
db.users.find({ 
  age: { $gte: 25 }, 
  city: "서울" 
})

// OR
db.users.find({
  $or: [
    { age: { $lt: 25 } },
    { city: "부산" }
  ]
})

// NOT
db.users.find({ 
  age: { $not: { $gte: 30 } } 
})

// NOR
db.users.find({
  $nor: [
    { age: { $lt: 25 } },
    { city: "서울" }
  ]
})
```

### 5.3 배열 쿼리
```javascript
// 배열 요소 포함
db.users.find({ hobbies: "독서" })

// 모든 요소 포함
db.users.find({ hobbies: { $all: ["독서", "영화감상"] } })

// 배열 크기
db.users.find({ hobbies: { $size: 2 } })

// 배열 요소 조건
db.users.find({ 
  "scores.math": { $gte: 90 } 
})
```

### 5.4 정규표현식
```javascript
// 패턴 매칭
db.users.find({ name: /^홍/ })           // 홍으로 시작
db.users.find({ name: /동$/ })           // 동으로 끝남
db.users.find({ name: /길/ })            // 길 포함
db.users.find({ email: /@gmail\.com$/}) // Gmail 주소
```

### 5.5 존재성 및 타입 검사
```javascript
// 필드 존재
db.users.find({ phone: { $exists: true } })

// 타입 검사
db.users.find({ age: { $type: "number" } })
db.users.find({ age: { $type: 16 } })    // BSON 타입 코드
```

---

## 6. 인덱싱

### 6.1 인덱스 기본
```javascript
// 단일 필드 인덱스
db.users.createIndex({ email: 1 })       // 오름차순
db.users.createIndex({ age: -1 })        // 내림차순

// 복합 인덱스
db.users.createIndex({ 
  "address.city": 1, 
  age: -1 
})

// 고유 인덱스
db.users.createIndex(
  { email: 1 }, 
  { unique: true }
)
```

### 6.2 특수 인덱스
```javascript
// 부분 인덱스
db.users.createIndex(
  { age: 1 },
  { partialFilterExpression: { age: { $gte: 18 } } }
)

// 텍스트 인덱스
db.articles.createIndex({ 
  title: "text", 
  content: "text" 
})

// 지리공간 인덱스
db.places.createIndex({ location: "2dsphere" })
```

### 6.3 인덱스 관리
```javascript
// 인덱스 조회
db.users.getIndexes()

// 인덱스 삭제
db.users.dropIndex({ email: 1 })
db.users.dropIndex("email_1")

// 모든 인덱스 삭제 (_id 제외)
db.users.dropIndexes()
```

### 6.4 쿼리 성능 분석
```javascript
// 실행 계획 확인
db.users.find({ age: 30 }).explain("executionStats")

// 인덱스 힌트
db.users.find({ age: 30 }).hint({ age: 1 })
```

---

## 7. 집계(Aggregation)

### 7.1 집계 파이프라인 기본
```javascript
db.orders.aggregate([
  { $match: { status: "completed" } },      // 필터링
  { $group: { 
    _id: "$customerId", 
    totalAmount: { $sum: "$amount" },
    orderCount: { $sum: 1 }
  }},
  { $sort: { totalAmount: -1 } },          // 정렬
  { $limit: 10 }                           // 제한
])
```

### 7.2 주요 집계 단계

#### $match - 필터링
```javascript
db.sales.aggregate([
  { $match: { 
    date: { $gte: new Date("2024-01-01") },
    amount: { $gte: 100 }
  }}
])
```

#### $group - 그룹화
```javascript
db.sales.aggregate([
  { $group: {
    _id: "$category",
    totalSales: { $sum: "$amount" },
    avgSales: { $avg: "$amount" },
    maxSales: { $max: "$amount" },
    minSales: { $min: "$amount" },
    count: { $sum: 1 }
  }}
])
```

#### $project - 필드 변환
```javascript
db.users.aggregate([
  { $project: {
    name: 1,
    email: 1,
    fullName: { $concat: ["$firstName", " ", "$lastName"] },
    age: { $subtract: [2024, "$birthYear"] },
    isAdult: { $gte: ["$age", 18] }
  }}
])
```

#### $unwind - 배열 펼치기
```javascript
db.orders.aggregate([
  { $unwind: "$items" },                   // items 배열 펼치기
  { $group: {
    _id: "$items.productId",
    totalQuantity: { $sum: "$items.quantity" }
  }}
])
```

#### $lookup - 조인
```javascript
db.orders.aggregate([
  { $lookup: {
    from: "customers",
    localField: "customerId",
    foreignField: "_id",
    as: "customer"
  }},
  { $unwind: "$customer" }
])
```

#### $sort와 $limit
```javascript
db.products.aggregate([
  { $sort: { price: -1 } },               // 가격 내림차순
  { $limit: 5 }                           // 상위 5개
])
```

### 7.3 복잡한 집계 예제
```javascript
// 월별 매출 통계
db.sales.aggregate([
  { $match: { 
    date: { $gte: new Date("2024-01-01") } 
  }},
  { $group: {
    _id: {
      year: { $year: "$date" },
      month: { $month: "$date" }
    },
    totalSales: { $sum: "$amount" },
    orderCount: { $sum: 1 },
    avgOrderValue: { $avg: "$amount" }
  }},
  { $sort: { "_id.year": 1, "_id.month": 1 } },
  { $project: {
    _id: 0,
    period: { $concat: [
      { $toString: "$_id.year" }, 
      "-", 
      { $toString: "$_id.month" }
    ]},
    totalSales: 1,
    orderCount: 1,
    avgOrderValue: { $round: ["$avgOrderValue", 2] }
  }}
])
```

---

## 8. 데이터 모델링

### 8.1 임베딩 vs 참조

#### 임베딩 (Embedding)
```javascript
// 블로그 포스트와 댓글
{
  _id: ObjectId("..."),
  title: "MongoDB 학습하기",
  content: "...",
  author: "홍길동",
  comments: [                              // 임베딩
    {
      author: "김철수",
      text: "좋은 글이네요!",
      date: new Date()
    },
    {
      author: "이영희",
      text: "도움이 되었습니다.",
      date: new Date()
    }
  ]
}
```

#### 참조 (Reference)
```javascript
// 사용자와 주문 (참조)
// Users 컬렉션
{
  _id: ObjectId("user1"),
  name: "홍길동",
  email: "hong@example.com"
}

// Orders 컬렉션
{
  _id: ObjectId("order1"),
  userId: ObjectId("user1"),               // 참조
  items: [...],
  total: 150000
}
```

### 8.2 스키마 설계 패턴

#### 1:1 관계
```javascript
// 사용자 기본 정보
{
  _id: ObjectId("..."),
  username: "hong123",
  email: "hong@example.com",
  profile: {                               // 임베딩
    firstName: "길동",
    lastName: "홍",
    bio: "개발자입니다.",
    avatar: "profile.jpg"
  }
}
```

#### 1:N 관계 (Few)
```javascript
// 사용자와 주소 (개수가 적을 때)
{
  _id: ObjectId("..."),
  name: "홍길동",
  addresses: [                             // 임베딩
    {
      type: "home",
      street: "강남대로 123",
      city: "서울"
    },
    {
      type: "office", 
      street: "테헤란로 456",
      city: "서울"
    }
  ]
}
```

#### 1:N 관계 (Many)
```javascript
// 저자와 책 (개수가 많을 때)
// Authors 컬렉션
{
  _id: ObjectId("author1"),
  name: "홍길동",
  bio: "..."
}

// Books 컬렉션
{
  _id: ObjectId("book1"),
  title: "MongoDB 완벽 가이드",
  authorId: ObjectId("author1"),           // 참조
  isbn: "..."
}
```

#### N:N 관계
```javascript
// 학생과 과목
// Students 컬렉션
{
  _id: ObjectId("student1"),
  name: "김학생",
  courseIds: [                             // 참조 배열
    ObjectId("course1"),
    ObjectId("course2")
  ]
}

// Courses 컬렉션
{
  _id: ObjectId("course1"),
  name: "데이터베이스",
  studentIds: [                            // 참조 배열
    ObjectId("student1"),
    ObjectId("student2")
  ]
}
```

### 8.3 스키마 검증
```javascript
// 컬렉션 생성 시 스키마 설정
db.createCollection("users", {
  validator: {
    $jsonSchema: {
      bsonType: "object",
      required: ["name", "email", "age"],
      properties: {
        name: {
          bsonType: "string",
          description: "이름은 문자열이어야 함"
        },
        email: {
          bsonType: "string",
          pattern: "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$",
          description: "유효한 이메일 형식이어야 함"
        },
        age: {
          bsonType: "int",
          minimum: 0,
          maximum: 150,
          description: "나이는 0-150 사이의 정수여야 함"
        }
      }
    }
  }
})
```

---

## 9. 복제 및 샤딩

### 9.1 복제 세트 (Replica Set)

#### 복제 세트 구성
```javascript
// 복제 세트 시작
mongod --replSet myReplicaSet --port 27017 --dbpath /data/db1
mongod --replSet myReplicaSet --port 27018 --dbpath /data/db2
mongod --replSet myReplicaSet --port 27019 --dbpath /data/db3

// 복제 세트 초기화
rs.initiate({
  _id: "myReplicaSet",
  members: [
    { _id: 0, host: "localhost:27017", priority: 2 },
    { _id: 1, host: "localhost:27018", priority: 1 },
    { _id: 2, host: "localhost:27019", priority: 1 }
  ]
})
```

#### 복제 세트 관리
```javascript
// 상태 확인
rs.status()

// 구성 확인
rs.conf()

// 멤버 추가
rs.add("localhost:27020")

// 멤버 제거
rs.remove("localhost:27020")

// 읽기 설정 (Secondary에서 읽기 허용)
rs.secondaryOk()
```

### 9.2 샤딩 (Sharding)

#### 샤드 클러스터 구성
```bash
# Config Server 시작
mongod --configsvr --replSet configReplSet --port 27019

# Shard 서버 시작
mongod --shardsvr --replSet shard1ReplSet --port 27018
mongod --shardsvr --replSet shard2ReplSet --port 27020

# MongoDB Router (mongos) 시작
mongos --configdb configReplSet/localhost:27019 --port 27017
```

#### 샤딩 설정
```javascript
// 샤드 추가
sh.addShard("shard1ReplSet/localhost:27018")
sh.addShard("shard2ReplSet/localhost:27020")

// 데이터베이스 샤딩 활성화
sh.enableSharding("myDatabase")

// 컬렉션 샤딩
sh.shardCollection("myDatabase.users", { userId: 1 })

// 샤드 상태 확인
sh.status()
```

---

## 10. 성능 최적화

### 10.1 쿼리 최적화
```javascript
// 1. 적절한 인덱스 사용
db.users.createIndex({ email: 1, status: 1 })

// 2. 선택적 필드만 조회
db.users.find({ status: "active" }, { name: 1, email: 1 })

// 3. 제한된 결과셋
db.users.find({ status: "active" }).limit(100)

// 4. 효율적인 정렬
db.users.find().sort({ createdAt: -1 }).limit(10)
```

### 10.2 집계 파이프라인 최적화
```javascript
// 1. $match를 먼저 사용하여 문서 수 줄이기
db.orders.aggregate([
  { $match: { status: "completed" } },     // 먼저 필터링
  { $lookup: { ... } },                    // 그 다음 조인
  { $group: { ... } }
])

// 2. $project로 불필요한 필드 제거
db.orders.aggregate([
  { $project: { 
    customerId: 1, 
    amount: 1, 
    date: 1 
  }},                                      // 필요한 필드만
  { $group: { ... } }
])
```

### 10.3 연결 풀 설정
```javascript
// Node.js 드라이버 예제
const { MongoClient } = require('mongodb');

const client = new MongoClient(uri, {
  maxPoolSize: 50,                         // 최대 연결 수
  minPoolSize: 5,                          // 최소 연결 수
  maxIdleTimeMS: 30000,                    // 유휴 연결 유지 시간
  serverSelectionTimeoutMS: 5000,          // 서버 선택 타임아웃
  socketTimeoutMS: 45000,                  // 소켓 타임아웃
});
```

### 10.4 모니터링
```javascript
// 현재 실행 중인 작업 확인
db.currentOp()

// 느린 쿼리 프로파일링 활성화
db.setProfilingLevel(2, { slowms: 100 })

// 프로파일링 결과 확인
db.system.profile.find().sort({ ts: -1 }).limit(5)

// 통계 정보 확인
db.stats()
db.users.stats()
```

---

## 11. 보안

### 11.1 인증 및 권한

#### 사용자 생성
```javascript
// 관리자 사용자 생성
use admin
db.createUser({
  user: "admin",
  pwd: "securePassword123",
  roles: [{ role: "userAdminAnyDatabase", db: "admin" }]
})

// 데이터베이스별 사용자 생성
use myDatabase
db.createUser({
  user: "appUser",
  pwd: "appPassword123",
  roles: [
    { role: "readWrite", db: "myDatabase" }
  ]
})
```

#### 역할 기반 접근 제어
```javascript
// 커스텀 역할 생성
db.createRole({
  role: "dataAnalyst",
  privileges: [
    { resource: { db: "sales", collection: "" }, actions: ["find"] },
    { resource: { db: "analytics", collection: "" }, actions: ["find", "insert"] }
  ],
  roles: []
})

// 사용자에게 역할 부여
db.grantRolesToUser("analyst", ["dataAnalyst"])
```

### 11.2 네트워크 보안
```yaml
# mongod.conf
net:
  port: 27017
  bindIp: 127.0.0.1,10.0.0.1          # 특정 IP만 바인딩
  
security:
  authorization: enabled                # 인증 활성화
  
setParameter:
  authenticationMechanisms: SCRAM-SHA-256
```

### 11.3 데이터 암호화
```yaml
# 저장 데이터 암호화 (Enterprise)
security:
  enableEncryption: true
  encryptionKeyFile: /path/to/keyfile
  
# TLS/SSL 설정
net:
  ssl:
    mode: requireSSL
    PEMKeyFile: /path/to/certificate.pem
    CAFile: /path/to/ca.pem
```

---

## 12. 실제 프로젝트 예제

### 12.1 블로그 시스템

#### 데이터 모델
```javascript
// 사용자 컬렉션
{
  _id: ObjectId("..."),
  username: "blogger123",
  email: "blogger@example.com",
  password: "hashedPassword",
  profile: {
    displayName: "블로거",
    bio: "기술 블로그를 운영합니다.",
    avatar: "avatar.jpg"
  },
  createdAt: new Date(),
  lastLoginAt: new Date()
}

// 포스트 컬렉션
{
  _id: ObjectId("..."),
  title: "MongoDB 학습기",
  slug: "mongodb-learning",
  content: "MongoDB를 학습하면서...",
  excerpt: "MongoDB 학습 후기",
  authorId: ObjectId("..."),
  tags: ["MongoDB", "Database", "NoSQL"],
  status: "published",
  publishedAt: new Date(),
  createdAt: new Date(),
  updatedAt: new Date(),
  viewCount: 0,
  likeCount: 0,
  comments: [
    {
      _id: ObjectId("..."),
      authorId: ObjectId("..."),
      content: "좋은 글이네요!",
      createdAt: new Date(),
      likes: 3
    }
  ]
}

// 카테고리 컬렉션
{
  _id: ObjectId("..."),
  name: "기술",
  slug: "tech",
  description: "기술 관련 포스트",
  postCount: 0
}
```

#### 주요 쿼리 예제
```javascript
// 최신 포스트 조회

---
---

hr의 emps 콜렉션을 조회합니다.

부서번호 22번에 근무하는 사원들의
이름, 나이 , 급여를 조회하는 쿼리를 작성합니다.

find(query, projection)

나이는 50세이상,
부서는 10,20,30번부서에 근무하며
급여가 5000이상인 직원의 정보를 출력하시오.
부서번호순으로 정렬바랍니다.

부서별로
평균급여를 출력합니다.

단, 나이가 50세 미만이고 급여가 5000이상인 직원을 대상으로 합니다.